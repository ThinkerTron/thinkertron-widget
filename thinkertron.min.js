/*!
 * 
 * ThinkerTron Widget
 * (c) 2025 ThinkerTron.com
 * This JavaScript is proprietary. Redistribution or modification is prohibited.
 * Use requires an active license or agreement with ThinkerTron.com
 * See: https://thinkertron.com/terms
 * Contact: hello@thinkertron.com
 *
 */"use strict";const THINKERTRON_CSS="#thinkertron-widget{z-index:10000;box-sizing:border-box;overflow:hidden;border-radius:.8rem .8rem .8rem 0;bottom:6%;right:3%;position:fixed;max-width:25rem;border:.3rem solid var(--thinkertron-fg);background-color:#888;background-color:var(--thinkertron-bg-override);color:var(--thinkertron-primary-text);box-shadow:0 -1px 1px rgba(0,0,0,8%),0 1px 1px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.12),0 4px 4px rgba(0,0,0,.12),0 8px 8px rgba(0,0,0,.12),0 16px 16px rgba(0,0,0,.12)}#thinkertron-widget #tt-badge-div{position:relative;background-color:var(--thinkertron-bg)}#thinkertron-widget #tt-theme-button,#thinkertron-widget #tt-minimise-button{height:100%;display:inline-block;position:absolute;top:0;cursor:pointer!important;pointer-events:auto}#thinkertron-widget #tt-theme-button{left:0rem}#thinkertron-widget #tt-minimise-button{right:0rem}#thinkertron-widget #tt-theme-button svg,#thinkertron-widget #tt-minimise-button svg{color:var(--thinkertron-fg);height:80%;display:inline-block;position:relative;top:50%;transform:translateY(-50%);padding:.1rem .3rem}#thinkertron-widget #tt-badge-text{font-family:var(--thinkertron-font);font-size:.9rem;line-height:.95rem;font-weight:600;color:var(--thinkertron-fg);width:100%;text-align:center;padding:.5rem .6rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer!important;display:inline-block;pointer-events:auto}#thinkertron-widget #tt-main-container{box-sizing:border-box;color:var(--thinkertron-bg);pointer-events:none;position:relative;padding:0;margin:0}#thinkertron-widget #tt-main{box-sizing:border-box;pointer-events:auto;position:relative;font-family:var(--thinkertron-font);font-size:var(--thinkertron-font-size,.8rem);line-height:var(--thinkertron-line-height);padding:.2rem;max-height:67dvh;min-height:25dvh;overflow-y:auto;scrollbar-width:none;width:100%;min-width:20rem}#thinkertron-widget #tt-latest{box-sizing:border-box;pointer-events:auto;cursor:pointer;position:absolute;bottom:2.5rem;border-radius:2rem 2rem 2rem 0;right:.5rem;z-index:4;text-align:center;height:auto;padding:.6rem 1.2rem;font-family:var(--thinkertron-font);font-size:.75rem;line-height:.8rem;background-color:var(--thinkertron-bg);opacity:1;color:var(--thinkertron-fg);font-weight:600;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-shadow:0 1px 1px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.12),0 4px 4px rgba(0,0,0,.12),0 8px 8px rgba(0,0,0,.12),0 16px 16px rgba(0,0,0,.12)}#thinkertron-widget #tt-form{box-sizing:border-box;padding:.4rem;width:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#thinkertron-widget #tt-input{box-sizing:border-box;pointer-events:auto;border:.05rem solid var(--thinkertron-bg);border-radius:1rem;padding:.3rem .5rem;background-color:var(--thinkertron-bg-override);color:var(--thinkertron-bg);font-family:var(--thinkertron-font);font-size:var(--thinkertron-font-size,.8rem);font-weight:400;position:relative;width:100%;cursor:pointer}#thinkertron-widget #tt-offline-div{box-sizing:border-box;position:absolute;top:1rem;right:.5rem;border-radius:2rem 2rem 2rem 0;z-index:2;text-align:center;height:auto;padding:.6rem 1.2rem;font-family:var(--thinkertron-font);font-size:.75rem;font-weight:600;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-shadow:0 1px 1px rgba(0,0,0,.12),0 2px 2px rgba(0,0,0,.12),0 4px 4px rgba(0,0,0,.12),0 8px 8px rgba(0,0,0,.12),0 16px 16px rgba(0,0,0,.12)}#thinkertron-widget #tt-main p{scroll-snap-align:start;margin:.5rem 0 0}#thinkertron-widget input[type=text]#tt-input::-webkit-input-placeholder{color:var(--thinkertron-bg)}#thinkertron-widget input[type=text]#tt-input::-moz-placeholder{color:var(--thinkertron-bg)}#thinkertron-widget .tt-you,#thinkertron-widget .tt-chat,#thinkertron-widget .tt-internal,#thinkertron-widget .tt-summary{font-family:var(--thinkertron-font);font-size:var(--thinkertron-font-size);font-weight:400;line-height:var(--thinkertron-line-height);padding:.3rem .4rem;color:var(--thinkertron-fg);margin-bottom:.7rem!important}#thinkertron-widget .tt-internal,#thinkertron-widget .tt-summary{border-radius:.7rem .7rem .7rem 0;background-color:var(--thinkertron-bg);color:var(--thinkertron-fg);font-size:.66rem;line-height:.8rem;margin-bottom:.9rem!important}#thinkertron-widget .tt-you{text-align:left;border-radius:.4rem .4rem .4rem 0;border:.05rem solid var(--thinkertron-bg);background-color:var(--thinkertron-bg-override);color:var(--thinkertron-bg);flex:none;max-width:77%;margin-bottom:.2rem!important}#thinkertron-widget .tt-chat{text-align:left;border-radius:.4rem .4rem .4rem 0;border:.05rem solid var(--thinkertron-bg);background-color:var(--thinkertron-bg-override);color:var(--thinkertron-bg);flex:none;max-width:77%}#thinkertron-widget .thinkertron-label{display:inline-block;position:absolute;font-size:.55rem;font-weight:500;line-height:.7rem;margin-top:.8rem;right:.2rem;border-radius:1rem;padding:.1rem .4rem;background-color:var(--thinkertron-fg);color:var(--thinkertron-bg);border:.05rem solid var(--thinkertron-bg);z-index:2}#thinkertron-widget .thinkertron-sender-label{display:inline-block;position:absolute;font-size:.55rem;font-weight:500;line-height:.7rem;margin-top:-.1rem;left:.2rem;border-radius:1rem;padding:.1rem .4rem;background-color:var(--thinkertron-bg);color:var(--thinkertron-fg);z-index:2}#thinkertron-widget .thinkertron-ai-label{background-color:var(--thinkertron-fg);color:var(--thinkertron-bg);border:.05rem solid var(--thinkertron-bg);z-index:2}#thinkertron-widget .msgrow{display:flex;justify-content:space-between}#thinkertron-widget .offlineIsButton{cursor:pointer;pointer-events:auto;background-color:var(--thinkertron-bg);color:var(--thinkertron-fg)}#thinkertron-widget .offlineIsNotButton{cursor:default;pointer-events:none;background-color:var(--thinkertron-bg);color:var(--thinkertron-fg);border:.2rem solid var(--thinkertron-fg)}#thinkertron-widget .thinkertron-animated-bg{background:linear-gradient(90deg,var(--thinkertron-fg),var(--thinkertron-bg));background-size:200% 100%;background-clip:border-box;-webkit-background-clip:border-box;animation:borderShift .5s linear infinite}@keyframes borderShift{0%{background-position:200%}100%{background-position:0}}",THINKERTRON_VERSION="1.0.21";(function(){const ve=window.ThinkerTronConfig||{},{INPUT_PLACEHOLDER:Z="Comment",DEFAULT_STICKER_MESSAGE:Y="ThinkerTron",HELLO_MESSAGE:De="This is a public chat. Share thoughts or questions with others, but protect your privacy. Set a nickname with /NickName â€” they're just for fun. Report issues with /alarm [reason].",ALARM_MESSAGE:ze="â€¼ï¸ /alarm is an automated feature that takes a deep look at the chat for potential privacy violations, abuse, violence, harassment, sexual material, child safety, self-harm, scams, or illegal activity. Checking now...",JUST_FOR_YOU:q="Private to you",NICKNAME_CHANGE_MESSAGE:Te="Your nickname is now",MODERATED_MESSAGE:Fe="Your comment was moderated",OFFLINE_MESSAGE:Me="Connect?",MAX_CONNS_REACHED_MESSAGE:Se="Waiting for a connection.",NO_ACTIVE_SUB_MESSAGE:Ae="No subscription.",JUST_YOU_MESSAGE:ke="Just you!",YOU_WORD:Ee="You",HELLO_WORD:Ce="Welcome",LATEST_TEXT:xe="â¬‡",INSTANT_AWARENESS:Oe=!0,CLOSE_SOCKET_AFTER_MINIMISE:we=15*1e3,CLOSE_SOCKET_AFTER_INACTIVITY:_e=3*60*1e3,HELLO_MESSAGE_DELAY:ye=300,PRIMARY_COLOR:O="#196ff0",PRIMARY_TEXT:je="",BACKGROUND_LIGHT_OVERRIDE:ne="",BACKGROUND_DARK_OVERRIDE:ge=""}=ve;let I=null,Q=null,e=null,g=null,_=null,B=null,t,y=!1,P=0;const pe=7;let k=!1,R=!1,o=!1,L="";const r=Object.freeze({ONLINE:"ONLINE",OFFLINE:"OFFLINE",MAX_CONNS_REACHED:"MAX_CONNS_REACHED",NO_ACTIVE_SUB:"NO_ACTIVE_SUB"});let x=r.OFFLINE,s=null,h=null,m=null,c=null,i=null,a=null,f=null,n=null,u=null,j=null,M=null,E=null,C=null,p=null;const he=!0,le=(()=>he?(console.log("Connecting to remote TT server."),"wss://thinkertron-server.onrender.com/ws"):(console.log("Connecting to local TT server."),"ws://127.0.0.1:8080/ws"))();function oe(){const e=localStorage.getItem("ThinkerTron3000Prefs");if(e)try{const n=JSON.parse(e);t.nick=n.nick||t.nick,t.open=n.open!==0[0]?n.open:t.open,t.theme=n.theme||"auto"}catch(e){console.warn("Invalid localStorage ThinkerTron3000Prefs:",e)}}function se(){t={nick:"Visitor",open:!1,theme:"auto"}}function S(){localStorage.setItem("ThinkerTron3000Prefs",JSON.stringify(t))}function H(){const e=s.children.length;if(e>500)for(let e=0;e<100;e++)s.firstElementChild&&s.removeChild(s.firstElementChild)}function ie(e){try{const t=new URL(e);let s=t.hostname.toLowerCase().replace(/^www\./,"").replace(/[^a-z0-9.-]/g,"").replace(/\.+/g,"."),o=t.pathname.replace(/\/+$/,"").replace(/^\/+/,"").toLowerCase(),n=o.split("/").filter(Boolean).map(e=>e.replace(/[^a-z0-9_.-]/g,"-").slice(0,50));const i=n.length?n.join("/"):"index";return[s,i]}catch(e){return console.error("Invalid URL in getURLString:",e),["invalid.domain","invalid/path"]}}function ae(e){if(typeof e!="function")return;document.readyState==="loading"?l(document,"DOMContentLoaded",e):e()}function re(e){const t=e.indexOf(":"),n=e.indexOf(":",t+1);if(t===-1||n===-1)return null;const s=e.slice(0,t),o=e.slice(t+1,n),i=e.slice(n+1);return{role:s,sender:o,message:i}}function ce(e){if(o)return;if(e.data.startsWith("/conns:")){let t=parseInt(e.data.split(":")[1],10);t<2?p.textContent=ke:p.textContent=`${Ee} + ${t-1}`}else if(e.data.startsWith("/nickname:")){let n=e.data.split(":")[1];t.nick==="Visitor"&&n&&(t.nick=n,S())}else ue(e.data,"broadcast")}function A(e){if(o)return;const n=document.createElement("p");n.className="tt-internal",n.textContent=e;const i=document.createElement("span");i.textContent=`${q}, ${t.nick}`,i.classList.add("thinkertron-label"),n.appendChild(i),s.appendChild(n),a.style.display=="none"&&b(),H()}function de(e){if(o)return;const t=document.createElement("p");t.className="tt-internal",t.textContent=e;const n=document.createElement("span");n.textContent=`${q}: ${Fe}`,n.classList.add("thinkertron-label"),t.appendChild(n),s.appendChild(t),a.style.display=="none"&&b(),H()}function ue(e){if(o)return;const l=re(e);if(!l)return;let{role:t,sender:h,message:n}=l;const m=[I,"thinkertron.com"],f=/\b((https?:\/\/)?(www\.)?([a-z0-9-]+\.[a-z]{2,})([^\s]*))/gi;if(n=n.replace(f,(e,t,n,s,o)=>m.some(e=>o.toLowerCase().endsWith(e))?e:`âš ï¸ ${e}`),t=="tt-system"){n=="MAX_CONNS_REACHED"&&(y=!1,w(r.MAX_CONNS_REACHED)),n=="NO_ACTIVE_SUB"&&w(r.NO_ACTIVE_SUB);return}if(t=="tt-moderated"){de(n);return}if(t=="tt-internal"){A(n);return}let i=document.createElement("div"),d=document.createElement("p"),c=document.createElement("p"),u=document.createElement("span");if(u.textContent=n,c.classList.add(t),c.appendChild(u),i.classList.add("msgrow"),t=="tt-you"&&i.appendChild(d),i.appendChild(c),t=="tt-chat"&&i.appendChild(d),t=="tt-chat"||t=="tt-summary"){const e=document.createElement("span");e.textContent=`${h}`,t=="tt-chat"?e.classList.add("thinkertron-sender-label"):(e.classList.add("thinkertron-sender-label"),e.classList.add("thinkertron-ai-label")),i.insertAdjacentElement("afterbegin",e)}s.appendChild(i),a.style.display=="none"&&b(),H()}function J(s){if(o)return;s.preventDefault(),n.classList.add("thinkertron-animated-bg"),setTimeout(()=>{n.classList.remove("thinkertron-animated-bg")},500);let i=n.value.trim().replace(/\s+/g," ").slice(0,1e3);if(!i)return;if(f.reset(),typeof i=="string"&&i.trim().toLowerCase().startsWith("/alarm")){A(`${ze}`);const n=i.trim(),s=n.slice(6).trim().replace(/^\/+/,"").slice(0,300),o=`__ALARM__${t.nick}:${s}`;try{e.send(o)}catch(e){console.warn("Send failed:",e)}return}if(typeof i=="string"&&i.trim().startsWith("/")){const n=i.trim().slice(1,21),e=n.replace(/[:;_]/g,""),s=e.length>0?e:"Visitor";t.nick=s,A(`${Te} ${t.nick}`),S();return}const a=`${t.nick}:${i}`;try{e.send(a)}catch(e){console.warn("Send failed:",e)}}function me(e){e=e.replace("#",""),e.length===3&&(e=e.split("").map(e=>e+e).join(""));const t=[+`0x${e.slice(0,2)}`,+`0x${e.slice(2,4)}`,+`0x${e.slice(4,6)}`],n=e=>{const t=e.map(e=>e/255).map(e=>e<=.03928?e/12.92:((e+.055)/1.055)**2.4);return.2126*t[0]+.7152*t[1]+.0722*t[2]},s=(e,t)=>{const s=Math.max(.022,n(e)),o=Math.max(.022,n(t));return 100*(o>s?(o**.56-s**.57)*1.14:(o**.65-s**.62)*1.14)};return Math.abs(s([0,0,0],t))>=Math.abs(s([255,255,255],t))?"#000000":"#ffffff"}function fe(){const e=je||me(O);let t=ne||e,n=ge||O;const s=document.createElement("style");s.textContent=`
            #thinkertron-widget {--thinkertron-bg: ${O};--thinkertron-fg: ${e};--thinkertron-bg-override: ${t};
            --thinkertron-font-size: 0.76rem; --thinkertron-line-height: 0.99rem; --thinkertron-font: -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif;}
            #thinkertron-widget[data-theme='light'] {--thinkertron-bg: ${O};--thinkertron-fg: ${e};--thinkertron-bg-override: ${t};} #thinkertron-widget[data-theme='dark'] {--thinkertron-bg: ${e};--thinkertron-fg: ${O};--thinkertron-bg-override: ${n};} @media (prefers-color-scheme: dark) {#thinkertron-widget:not([data-theme]) {--thinkertron-bg: ${e}; --thinkertron-fg: ${O}; --thinkertron-bg-override: ${n};}}`+THINKERTRON_CSS,document.head.appendChild(s)}function z(e){const t=new DOMParser,n=t.parseFromString(e,"image/svg+xml");return n.documentElement}function K(e){e==="auto"?c.removeAttribute("data-theme"):c.setAttribute("data-theme",e),M.style.display="none",E.style.display="none",C.style.display="none",e==="auto"?M.style.display="":e==="light"?E.style.display="":e==="dark"&&(C.style.display="")}function X(){const e=["auto","light","dark"],s=t.theme||"auto",o=e.indexOf(s),n=e[(o+1)%e.length];t.theme=n,S(),K(n)}function be(){c=document.createElement("div"),c.id="thinkertron-widget",u=document.createElement("div"),u.id="tt-theme-button",l(u,"click",e=>{e.stopPropagation(),X()}),M=z(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M9 2C12.87 2 16 5.13 16 9C16 11.38 14.81 13.47 13 14.74V17C13 17.55 12.55 18 12 18H6C5.45 18 5 17.55 5 17V14.74C3.19 13.47 2 11.38 2 9C2 5.13 5.13 2 9 2M6 21V20H12V21C12 21.55 11.55 22 11 22H7C6.45 22 6 21.55 6 21M9 4C6.24 4 4 6.24 4 9C4 11.05 5.23 12.81 7 13.58V16H11V13.58C12.77 12.81 14 11.05 14 9C14 6.24 11.76 4 9 4M19 13H17L13.8 22H15.7L16.4 20H19.6L20.3 22H22.2L19 13M16.85 18.65L18 15L19.15 18.65H16.85Z"/></svg>`),u.appendChild(M),E=z(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>`),E.style.cssText="display: none;",u.appendChild(E),C=z(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M17 6H7C3.69 6 1 8.69 1 12S3.69 18 7 18H17C20.31 18 23 15.31 23 12S20.31 6 17 6M17 16H7C4.79 16 3 14.21 3 12S4.79 8 7 8H17C19.21 8 21 9.79 21 12S19.21 16 17 16M17 9C15.34 9 14 10.34 14 12S15.34 15 17 15 20 13.66 20 12 18.66 9 17 9Z"/></svg>`),C.style.cssText="display: none;",u.appendChild(C),j=document.createElement("div"),j.id="tt-minimise-button";const e=z(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M12 20.03C7.59 20.03 3.97 16.41 3.97 12C3.97 7.59 7.59 3.97 12 3.97C16.41 3.97 20.03 7.59 20.03 12C20.03 16.41 16.41 20.03 12 20.03M12 22C17.54 22 22 17.54 22 12C22 6.46 17.54 2 12 2C6.46 2 2 6.46 2 12C2 17.54 6.46 22 12 22M13.88 12.47L16 10.36V16H10.36L12.47 13.88L7.5 8.9L8.9 7.5"/></svg>`);j.appendChild(e),l(j,"click",e=>{e.stopPropagation(),N()}),p=document.createElement("div"),p.id="tt-badge-text",p.textContent=Y,m=document.createElement("div"),m.id="tt-badge-div",l(m,"click",e=>{e.stopPropagation(),N()}),m.appendChild(p),m.appendChild(j),m.appendChild(u),h=document.createElement("div"),h.id="tt-main-container",s=document.createElement("div"),s.id="tt-main",s.addEventListener("scroll",()=>{const e=6,t=Math.abs(s.scrollHeight-s.scrollTop-s.clientHeight)<=e;a.style.display=t?"none":""}),a=document.createElement("div"),a.id="tt-latest",a.textContent=xe,a.style.cssText=`display:none;`,l(a,"click",V),h.appendChild(a),f=document.createElement("form"),f.id="tt-form",f.setAttribute("autocomplete","off"),l(f,"submit",J),n=document.createElement("input"),n.id="tt-input",n.type="text",n.placeholder="",l(n,"click",v),l(n,"input",v),n.setAttribute("autocomplete","off"),n.setAttribute("maxlength","1000"),n.setAttribute("spellcheck","false"),n.setAttribute("placeholder",Z),l(n,"focus",G),l(n,"blur",W),i=document.createElement("div"),i.id="tt-offline-div",a.style.cssText=`display:none;`,l(i,"click",te),i.textContent="...",h.appendChild(i),h.appendChild(s),f.appendChild(n),h.appendChild(f),c.appendChild(h),c.appendChild(m),document.body.appendChild(c)}function v(){if(o)return;clearTimeout(g),g=setTimeout(()=>{y=!0,F("inactivity")},_e)}function F(){e&&e.readyState===WebSocket.OPEN&&e.close()}function $(){if(o)return;t.open==!0?(h.style.display="",c.style.borderRadius="0.8rem 0.8rem 0.8rem 0rem",u.style.display="",j.style.display=""):(h.style.display="none",c.style.borderRadius="2rem 2rem 2rem 0rem",u.style.display="none",j.style.display="none")}function N(){if(o)return;if(R)return;R=!0,setTimeout(()=>{R=!1},200),t.open=!t.open,S(),$(),b(),v(),t.open&&(!e||e&&e.readyState==WebSocket.CLOSED)&&(y=!1,T()),!t.open&&e&&(g=setTimeout(F,we))}function w(e){if(o)return;x=e;let t="";switch(e){case r.ONLINE:i.style.display="none",n.style.display="";break;case r.OFFLINE:t=L+Me,i.style.display="",n.style.display="none",a.style.display="none",i.classList.remove("offlineIsNotButton"),i.classList.add("offlineIsButton");break;case r.MAX_CONNS_REACHED:t=Se,i.style.display="",n.style.display="none",a.style.display="none",i.classList.remove("offlineIsButton"),i.classList.add("offlineIsNotButton");break;case r.NO_ACTIVE_SUB:t=Ae,i.style.display="",n.style.display="none",a.style.display="none",i.classList.remove("offlineIsButton"),i.classList.add("offlineIsNotButton");break;default:console.log("Unknown ThinkerTron state: "+e)}i.textContent=t}function te(){if(o)return;v(),x===r.OFFLINE&&(y=!1,T())}function ee(){if(P>=pe){_=null,w(r.OFFLINE);return}P++,_=setTimeout(()=>{T(),ee()},4500)}function T(){if(L="",o)return;if(k)return;if(k=!0,y=!1,clearTimeout(g),v(),e&&[WebSocket.OPEN,WebSocket.CONNECTING,WebSocket.CLOSING].includes(e.readyState)){k=!1;return}_||(P=0);const n=`${window.location.origin}${window.location.pathname}`;[I,Q]=ie(n);const i=`${le}/${I}/${Q}`;e=new WebSocket(i);const c=e;e.onerror=e=>{console.log("Connection Error."),L="Network error. "},e.onopen=()=>{if(o)return;k=!1,clearTimeout(g),v(),w(r.ONLINE),y=!1,D(),setTimeout(()=>{x===r.ONLINE&&(w(r.ONLINE),A(`${Ce} ${t.nick}! `+De))},ye)},e.onmessage=e=>{if(o)return;ce(e)},e.onclose=t=>{if(o)return;if(e!==c){console.log("Stale socket close ignored.");return}k=!1,x!==r.MAX_CONNS_REACHED&&x!==r.NO_ACTIVE_SUB&&w(r.OFFLINE),clearTimeout(g),D(),e.onmessage=e.onopen=e.onclose=null,e=null,p.textContent=Y,s.innerHTML="",a.style.display="none",b(),y?console.log("ThinkerTron connection released."):x===r.MAX_CONNS_REACHED&&!_&&ee()},window.__tt_beforeThinkerTronUnloadListenerAdded||(window.__tt_beforeThinkerTronUnloadListenerAdded=!0,window.addEventListener("beforeunload",()=>{F()}))}function U(){if(o)return;clearTimeout(B),B=null,B=setTimeout(()=>{requestAnimationFrame(()=>{b()})},200)}function G(){this.placeholder=""}function W(){this.placeholder=Z}function V(){b()}function b(){if(o)return;requestAnimationFrame(()=>{s&&(s.scrollTop=s.scrollHeight)})}function D(){clearTimeout(_),_=null}function d(e,t,n){e&&typeof e.removeEventListener=="function"&&typeof n=="function"&&e.removeEventListener(t,n)}function l(e,t,n,s){e&&typeof e.addEventListener=="function"&&typeof n=="function"&&e.addEventListener(t,n,s||!1)}window.teardownThinkerTron=function(){if(o)return;o=!0,d(window,"resize",U),d(window,"beforeunload",F),d(f,"submit",J),d(n,"click",v),d(n,"input",v),d(n,"focus",G),d(n,"blur",W),d(m,"click",N),d(a,"click",V),d(i,"click",te),d(u,"click",X),clearTimeout(g),g=null,D(),e&&e.readyState===WebSocket.OPEN&&e.close(),e=null,c&&c.parentNode&&c.parentNode.removeChild(c),s=h=m=p=c=i=a=f=n=null,t=null},ae(function(){console.log(`ðŸŸ¢ ThinkerTron Widget v${THINKERTRON_VERSION} booting...`),se(),oe(),fe(),be(),K(t.theme),$(),(t.open||Oe)&&setTimeout(()=>T(),200),l(window,"resize",U)})})()